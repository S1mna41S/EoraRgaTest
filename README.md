# EORA RAG (FastAPI + FAISS + GigaChat)

Минимальный RAG-сервис, который отвечает на вопросы по материалам кейсов **eora.ru** и в ответе указывает источники. Сделано «как есть» для демонстрации подхода.

---

## Что пробовал сделать

- Собрал минимальный RAG: FastAPI `/ask` → FAISS → LLM → ответ со ссылками.  
- Индексация ссылок из ТЗ: скачивание страниц, чистка текста (`trafilatura` → `bs4`), чанкинг и индекс в FAISS.  
- Сначала попробовал OpenAI, но упёрся в квоту (`insufficient_quota`), переключился на GigaChat.  
- Эмбеддинги GigaChat на моей сети спотыкались об SSL, сделал fallback на `sentence-transformers`, чтобы индексация не ломалась.  
- Ответ генерирую через GigaChat (SDK), в DEV иногда запускал с `GIGACHAT_VERIFY_SSL=false`.

**Что сработало**
- Индексация и поиск по FAISS; ответы со списком источников (и при желании можно вставлять `[n]` в тексте).
- Fallback эмбеддингов — спасает, когда GigaChat недоступен по TLS.

**Что не очень**
- OpenAI отпал из-за квоты.
- С `GIGACHAT_VERIFY_SSL=true` на моём окружении не завелось (скорее всего, корпоративный прокси/сертификаты).
- Пару ссылок периодически падали из-за HTTP/2 EOF — помогли ретраи и `http2=false`.

**Как проверял**
- Ручные вопросы из ТЗ + несколько своих; смотрел, чтобы факты подтверждались ссылками из индекса.
- Проверял размер индекса и что retriever вытаскивает нужные куски.

**Если было бы больше времени**
- Телеграм-бот (один `/ask`, проксирующий в FastAPI).
- «Строгие» цитаты (валидация `[n]`), кэш ответов, инкрементальная индексация по sitemap, Dockerfile/compose, небольшой веб-виджет.

---

## Быстрый старт

```bash
# 1) Виртуальное окружение
python -m venv .venv
# Windows:
.venv\Scripts\activate
# Linux/macOS:
source .venv/bin/activate

# 2) Зависимости
pip install -r requirements.txt

# 3) Конфиг
cp .env.example .env
# В .env заполнить GIGACHAT_CREDENTIALS (см. ниже)

# 4) Индексация ссылок из data/links.txt
python -m rag.ingest

# 5) Запуск API
uvicorn api.main:app --reload
# Документация: http://127.0.0.1:8000/docs

# 6) Проба запроса
curl -X POST http://127.0.0.1:8000/ask \
  -H "Content-Type: application/json" \
  -d "{\"question\":\"Что вы можете сделать для ритейлеров?\",\"k\":6}"
